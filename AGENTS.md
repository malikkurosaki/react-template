# AGENTS.md - Coding Agent Instructions

## Build Commands

```bash
# Development
bun dev              # Start Vite (3000) + Bun backend (3001) with HMR
bun run dev:backend  # Start Bun backend only (port 3001)
bun run dev:frontend # Start Vite frontend only (port 3000)
bun run watch:routes # Watch and regenerate routes

# Production
bun build            # Build for production (outputs to dist/)
bun start            # Start production server (port 3000)

# Code Quality
bun run check        # Biome check --write (lint + format + fix)
bun run format       # Biome format --write
bun run lint         # Biome lint (read-only)

# Routes
bun run generate     # Generate TanStack routes manually
```

**Note:** No test framework is configured. To run tests, you would need to add a test runner like Bun's built-in test runner or Vitest.

## Code Style Guidelines

### Formatting (Biome)
- **Indent:** Tabs (not spaces)
- **Quotes:** Double quotes for strings
- **Line width:** Default (80 chars)
- **Semicolons:** Required
- Run `bun run check` before committing

### Imports
- Use path alias `@/*` for src imports (e.g., `import { auth } from "@/utils/auth"`)
- Organize imports: Biome auto-organizes on check
- Order: External libs → Internal (@/) → Relative (../)
- Use `type` imports for type-only imports: `import type { Foo } from "bar"`

### TypeScript
- Strict mode enabled
- Use explicit return types for exported functions
- Prefer `interface` over `type` for object shapes
- Use `satisfies` operator where appropriate
- Path mapping: `@/*` → `./src/*`

### Naming Conventions
- **Components:** PascalCase (e.g., `DashboardComponent`)
- **Functions:** camelCase (e.g., `useAuth`, `apiMiddleware`)
- **Constants:** SCREAMING_SNAKE_CASE for true constants
- **Files:** camelCase for utilities, PascalCase for components
- **Routes:** Match filename to URL path (file-based routing)

### React Patterns
- Use function declarations for components (not arrow functions)
- Use React 19 features (StrictMode enabled)
- State management: Valtio for global, useState for local
- TanStack Router for routing (file-based in `src/pages/`)
- Mantine UI v8 for components

### Server (Elysia)
- Server entry: `src/index.ts`
- API routes defined with Elysia chains (`.get()`, `.post()`, etc.)
- Use `derive()` for middleware (auth, context)
- Prefix: `/api` for all API routes
- Swagger docs at `/api/docs`

### Error Handling
- Throw `new Error()` for critical failures
- Return early with error responses in middleware
- Use try/catch for async operations
- Log warnings with `console.warn()` for auth failures
- Type-safe error handling with proper HTTP status codes

### Project Structure
```
src/
├── pages/          # React pages (TanStack Router file-based)
│   ├── __root.tsx  # Root layout
│   └── *.tsx       # Pages auto-route by filename
├── middleware/     # Elysia middleware
├── utils/          # Utilities (auth, db, api-client)
├── store/          # Valtio state stores
├── context/        # React contexts
├── router.tsx      # TanStack router config
├── frontend.tsx    # React entry point
└── index.ts        # Server entry point
```

### Key Libraries
- **Server:** Elysia + Better Auth
- **Client:** React 19 + TanStack Router
- **UI:** Mantine v8
- **State:** Valtio (proxy-based)
- **DB:** Prisma with PostgreSQL
- **Build:** Bun (bundler + runtime)
- **DevTools:** react-dev-inspector (Shift+A to inspect components)

### Environment Variables
- Prefix public vars with `BUN_PUBLIC_*`
- Required: `BUN_PUBLIC_BASE_URL`, `BETTER_AUTH_SECRET`
- Optional: `GITHUB_CLIENT_ID`, `GITHUB_CLIENT_SECRET`, `JWT_SECRET`

### Generated Files
- `src/routeTree.gen.ts` - Auto-generated by TanStack Router
- `generated/prisma/` - Auto-generated by Prisma
- Do not manually edit these files
